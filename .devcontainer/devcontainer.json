// This devcontainer assumes an external Postgres database
// (e.g. Supabase, RDS, or locally hosted), not a containerized DB.
// Connection auth is handled via the Postgres CLI and ~/.pgpass.

{
  "name": "HearingsDemo Env (Java 17 & Postgres)",
  // Use the specific Java image (Lighter/Faster than Universal)
  "image": "mcr.microsoft.com/devcontainers/java:1-17-bookworm",

  "features": {
    // Installs the PostgreSQL client tools (psql, pg_dump, etc.)
    "ghcr.io/devcontainers-contrib/features/postgres-client:1": {}
  },

  "customizations": {
    "vscode": {
      "extensions": [
        // 1. Core Java & Spring Pack (Includes Maven, Gradle, Debugger, Test Runner)
        "vscjava.vscode-java-pack",
        
        // 2. Spring Boot Extension Pack (Includes Dashboard, Initializr, Tools)
        "vmware.vscode-boot-dev-pack",

        // 3. Database Management
        "ms-ossdata.vscode-postgresql",

        // 4. Utility
        "redhat.vscode-xml"

      ],
      "settings": {
        "java.configuration.updateBuildConfiguration": "automatic",
        "pgsql.format.keywordCase": "upper",
        // Ensures the test runner finds your new integration tests
        "java.test.config": {
            "name": "HearingsDemoTests",
            "workingDirectory": "${workspaceFolder}"
        }
      }
    }
  },

  // COMMANDS EXPLAINED:
  // 1. Grant execute permissions to mvnw (common issue on Windows/Mac handovers)
  // 2. Setup .pgpass for passwordless DB connection using the Github Secret
  "postCreateCommand": "chmod +x mvnw && if [ -n \"$DB_PASSWORD\" ]; then echo \"*:*:*:*:$DB_PASSWORD\" > ~/.pgpass && chmod 0600 ~/.pgpass; else echo 'Warning: DB_PASSWORD not set'; fi",

  // Connect to the internal network if needed (usually defaults are fine)
  "remoteUser": "vscode"
}
