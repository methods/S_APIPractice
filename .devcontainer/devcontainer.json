// This devcontainer assumes an external Postgres database
// (e.g. Supabase, RDS, or locally hosted), not a containerized DB.
// Connection auth is handled via the Postgres CLI and ~/.pgpass.

{
  "name": "HearingsDemo Env (Java 17 & Postgres)",
  // Use the specific Java image (Lighter/Faster than Universal)
  "image": "mcr.microsoft.com/devcontainers/java:1-17-bookworm",

  "customizations": {
    "vscode": {
      "extensions": [
        // 1. Core Java & Spring Pack (Includes Maven, Gradle, Debugger, Test Runner)
        "vscjava.vscode-java-pack",
        
        // 2. Spring Boot Extension Pack (Includes Dashboard, Initializr, Tools)
        "vmware.vscode-boot-dev-pack",

        // 3. Database Management
        "ms-ossdata.vscode-postgresql",

        // 4. Utility
        "redhat.vscode-xml"

      ],
      "settings": {
        "java.configuration.updateBuildConfiguration": "automatic",
        "pgsql.format.keywordCase": "upper",
        // Ensures the test runner finds your new integration tests
        "java.test.config": {
            "name": "HearingsDemoTests",
            "workingDirectory": "${workspaceFolder}"
        }
      }
    }
  },

  // UPDATED COMMAND:
  // 1. sudo apt-get install: Installs postgres-client reliably from Debian repos.
  // 2. chmod +x mvnw: Fixes permission issues.
  // 3. .pgpass: Sets up database secrets.
  "postCreateCommand": "sudo apt-get update && sudo apt-get install -y postgresql-client && chmod +x mvnw && if [ -n \"$DB_PASSWORD\" ]; then echo \"*:*:*:*:$DB_PASSWORD\" > ~/.pgpass && chmod 0600 ~/.pgpass; else echo 'Warning: DB_PASSWORD not set'; fi",

  "remoteUser": "vscode"
}
